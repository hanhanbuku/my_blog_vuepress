---
title: gitæäº¤ä¿¡æ¯è§„èŒƒ-commitlint
date: 2023-03-04 16:07:53
permalink: /pages/e49859/
categories:
  - æŠ€æœ¯
  - Git
tags:
  - 
---
## å‰è¨€
>åœ¨å‰ç«¯å·¥ç¨‹åŒ–çš„é“è·¯ä¸Šï¼Œå°‘ä¸äº†è®¸è®¸å¤šå¤šå‡ºè‰²çš„å·¥å…·çš„é“ºå«ï¼Œä»Šå¤©å°±æ¥å­¦ä¹ ä¸€ä¸‹ï¼Œåœ¨å›¢é˜Ÿåˆä½œçš„é¡¹ç›®ä¸­ï¼Œå¦‚ä½•è§„èŒƒå¤§å®¶æäº¤çš„commitï¼Œä»¥ä¾¿é¡¹ç›®çš„ç®¡ç†ã€‚

## commitlint 
commitlintæ˜¯å¯¹æˆ‘ä»¬æäº¤commitçš„æ ¼å¼çš„ä¸€ç§çº¦æŸï¼Œå¯ä»¥èµ·åˆ°å¾ˆå¥½çš„ç»Ÿä¸€ä½œç”¨ï¼Œå¦‚æœæœ‰äººæäº¤çš„commitä¸ç¬¦åˆè§„èŒƒï¼Œé‚£å°±å¯ä»¥é˜»æ­¢æœ¬æ¬¡æäº¤ã€‚

- æäº¤æ ¼å¼ (æ³¨æ„å†’å·åé¢æœ‰ç©ºæ ¼)
```shell
git commit -m <type>[optional scope]: <description>
```
> type ï¼šç”¨äºè¡¨æ˜æˆ‘ä»¬è¿™æ¬¡æäº¤çš„æ”¹åŠ¨ç±»å‹ï¼Œæ˜¯æ–°å¢äº†åŠŸèƒ½ï¼Ÿè¿˜æ˜¯ä¿®æ”¹äº†æµ‹è¯•ä»£ç ï¼Ÿåˆæˆ–è€…æ˜¯æ›´æ–°äº†æ–‡æ¡£ï¼Ÿ 
> optional scopeï¼šä¸€ä¸ªå¯é€‰çš„ä¿®æ”¹èŒƒå›´ã€‚ç”¨äºæ ‡è¯†æ­¤æ¬¡æäº¤ä¸»è¦æ¶‰åŠåˆ°ä»£ç ä¸­å“ªä¸ªæ¨¡å—ã€‚ 
> descriptionï¼šä¸€å¥è¯æè¿°æ­¤æ¬¡æäº¤çš„ä¸»è¦å†…å®¹ï¼Œåšåˆ°è¨€ç®€æ„èµ…ã€‚

- å¸¸è§çš„typeç±»å‹

| ç±»å‹        | æè¿°           |
| ------------- |:-------------:|
| build   | ç¼–è¯‘ç›¸å…³çš„ä¿®æ”¹ï¼Œä¾‹å¦‚å‘å¸ƒç‰ˆæœ¬ã€å¯¹é¡¹ç›®æ„å»ºæˆ–è€…ä¾èµ–çš„æ”¹åŠ¨ |
| chore      | å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰      | 
| ci| æŒç»­é›†æˆä¿®æ”¹      |
| docs| æ–‡æ¡£ä¿®æ”¹      |
| feat| æ–°ç‰¹æ€§ã€æ–°åŠŸèƒ½      |
| fix| ä¿®æ”¹bug      |
| perf| ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ      |
| refactor| ä»£ç é‡æ„      |
| revert| å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬      |
| style| ä»£ç æ ¼å¼ä¿®æ”¹, æ³¨æ„ä¸æ˜¯ css ä¿®æ”¹      |
| test| æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹      |

åœ¨ä½¿ç”¨ä»–ä¹‹å‰è¿˜éœ€è¦è®¤è¯†ä¸€ä¸ªä¸œè¥¿ï¼Œé‚£å°±æ˜¯husky

## husky

>Modern native Git hooks made easy (è½»æ¾åˆ›å»ºç°ä»£åŒ–çš„åŸç”Ÿ git hooks) Husky improves your commits and more ğŸ¶ woof!

å®ƒå¯ä»¥åœ¨ git æäº¤ä»£ç çš„å‰åï¼Œæ‰§è¡Œä¸€ç³»åˆ—çš„ git hooksï¼Œä»¥å¯¹ä»£ç ã€æ–‡ä»¶ç­‰è¿›è¡Œé¢„è®¾çš„æ£€æŸ¥ï¼Œä¸€æ—¦æ£€æŸ¥ä¸é€šè¿‡ï¼Œå°±å¯ä»¥é˜»æ­¢å½“å‰çš„ä»£ç æäº¤ï¼Œé¿å…äº†ä¸è§„èŒƒçš„ä»£ç å’Œ git æäº¤å‡ºç°åœ¨é¡¹ç›®ä¸­ã€‚

é€šä¿—ä¸€ç‚¹æ¥è¯´å°±æ˜¯huskyå¯ä»¥æ‰§è¡Œgitçš„ä¸€äº›åˆ—é’©å­ï¼Œä¾‹å¦‚git commit,git pushç­‰ç­‰ã€‚é€šè¿‡ä»–ï¼Œå†æ­é…ä¸Šcommitlintï¼Œå°±å¯ä»¥å®Œæˆæˆ‘ä»¬çš„è§„èŒƒæäº¤commitçš„æ“ä½œäº†ï¼Œä¸‹é¢å°±æ¥ä¸€èµ·æ“ä½œä¸€ä¸‹å§

## å¼€å§‹

é¦–å…ˆå®‰è£…ä¸€ä¸‹è¿™ä¸¤ä¸ªä¾èµ–
```shell
npm install -D husky

npm install --save-dev @commitlint/config-conventional @commitlint/cli

```

æ¥ä¸‹æ¥åœ¨æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶```commitlint.config.js```ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ .```commitlintrc.js```

```js
module.exports = { extends: ['@commitlint/config-conventional'] }

```
ä¸‹é¢å°±æ˜¯å»é…ç½®huskyäº†ã€‚

åœ¨huskyï¼ˆ6.0.0ï¼‰ç‰ˆæœ¬ä¹‹å‰ä»¥åŠä¹‹åçš„é…ç½®æ–¹å¼æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œä½ç‰ˆæœ¬çš„é…ç½®æ–¹æ³•å¦‚ä¸‹

åœ¨```package.json```ä¸­å†™å…¥
```json
{
  "husky": {
    "hooks": {
      "pre-commit": "npm run test", // åœ¨æ‰§è¡Œgit commitä¹‹å‰å…ˆè‡ªåŠ¨æ‰§è¡Œnpm run testå‘½ä»¤
      "commit-msg": "commitlint -e $HUSKY_GIT_PARAMS" // æ ¡éªŒcommitæ—¶æ·»åŠ çš„å¤‡æ³¨ä¿¡æ¯æ˜¯å¦ç¬¦åˆæˆ‘ä»¬è¦æ±‚çš„è§„èŒƒ
    }
  }
}
```
6.0.0ç‰ˆæœ¬ä¹‹åéœ€è¦æˆ‘ä»¬è‡ªå·±å»ç”Ÿæˆè„šæœ¬

é¦–å…ˆåœ¨package.jsonä¸­é…ç½®
```json
{
  "scripts": {
    "prepare": "husky install"
  }
}
```
æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ª.husky/çš„æ–‡ä»¶å¤¹ï¼Œè¿™é‡Œé¢å¯ä»¥å¯¹huskyè¿›è¡Œä¸€äº›åˆ—é…ç½®ä»¥åŠæ”¾ç½®é’©å­è„šæœ¬

æ‰§è¡Œ
```shell
npx husky add .husky/pre-commit "npm run test" 
```
è¿è¡Œå®Œè¯¥å‘½ä»¤åæˆ‘ä»¬ä¼šçœ‹åˆ°.husky/ç›®å½•ä¸‹æ–°å¢äº†ä¸€ä¸ªåä¸ºpre-commitçš„shellè„šæœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨åœ¨æ‰§è¡Œgit commitå‘½ä»¤æ—¶ä¼šå…ˆæ‰§è¡Œpre-commitè¿™ä¸ªè„šæœ¬ã€‚pre-commitè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š

```shell
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"
   
npm run  test
```
å¯ä»¥çœ‹åˆ°è¯¥è„šæœ¬çš„åŠŸèƒ½å°±æ˜¯æ‰§è¡Œnpm run testè¿™ä¸ªå‘½ä»¤

å†æ‰§è¡Œ
```shell
npx husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"' 
```
å°±ä¼šç”Ÿæˆcommit-msgè„šæœ¬
```shell
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx --no-install commitlint --edit $1

```
è¿™æ ·ï¼Œå½“æˆ‘ä»¬åœ¨æäº¤ä»£ç çš„æ—¶å€™å°±å¯ä»¥è¿›è¡Œè‡ªåŠ¨æ ¡éªŒæˆ–è€…åœ¨commitä¹‹å‰æ‰§è¡Œä¸€äº›è„šæœ¬æ‹‰ï¼Œæ¯”å¦‚åœ¨æäº¤commitä¹‹å‰å…ˆæ‰§è¡Œä¸€ä¸‹æµ‹è¯•è„šæœ¬ï¼Œæˆ–è€…å…ˆæ‰§è¡Œlintä»£ç æ£€æŸ¥ä¹‹ç±»çš„ã€‚

## æ›´æ–°
husky9.0ç‰ˆæœ¬ä¹‹å ä¸åœ¨éœ€è¦ç»™æ‰§è¡Œè„šæœ¬æ·»åŠ 
```
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"
```
æ‹¿commit-msgæ–‡ä»¶ä¸¾ä¾‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é‡Œé¢å†™ä¸Š
```ts
npx --no-install commitlint --edit $1
```
è¿™æ ·å°±å¯ä»¥äº†